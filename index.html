<html>
<head>
	<title>INFO 3300 - Project 1</title>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="http://d3js.org/topojson.v2.min.js"></script>
	<style>
		svg { border: solid #ccc 1px; }
	</style>
</head>
<body>
	<!--
		Note: to open up server use:
			python -m SimpleHTTPServer 
			python -m http.server
		-->

		<div id="visualization" style="width: 100%;"></div>

		<script>
			var debug = true;
			var footerOffset = 20;
			var mainDiv = d3.select("#visualization");

		// code for debugs
		if (debug) 
			mainDiv.style("border", "1px solid black");

		// set height to window height
		mainDiv.style("height", window.innerHeight - footerOffset);

	</script>

	<script>		
		var birthData;
		var rawBirthData;
		var GDPData;
		var rawGDPData;

		loadData(function(rawBirthData, birthData, rawGDPData, GDPData, rawCombinedData, combinedData) {
			// anything not in here can't view the 'global' variables, will find a work around if possible in time frame
			// DO ALL CODE IN HERE! //

			console.log(combinedData);


		});

		function loadData(callback){
			d3.csv("FilteredBirthRate.csv", parseBirth, function(error, data){
				rawBirthData = data;

				var nestedBirthData = d3.nest()
				.key(function(d) {
					return d.country; 
				})
				.sortKeys(d3.ascending)
				.entries(rawBirthData);

				d3.csv("FilteredGDPPerCap.csv", parseGDP, function(error, data){
					rawGDPData = data;

					var nestedGDPData = d3.nest()
					.key(function(d) {
						return d.country; 
					})
					.sortKeys(d3.ascending)
					.entries(rawGDPData);

					d3.csv("Combined.csv", parseCombined, function(error, data) {
						var nestedCombinedData = d3.nest()
						.key(function(d){
							return d.country;
						})
						.sortKeys(d3.ascending)
						.entries(data);

						callback(rawBirthData, nestedBirthData, rawGDPData, nestedGDPData, data, nestedCombinedData);
					});
				});
			});
		};

		function parseBirth (line) {
			line.country = line['Country Name'];
		/*	return {
				country: line.country,
				birthrate: line['2014']
			};*/
			return line;
		}

		function parseGDP (line) {
			line.country = line['Country Name'];
		/*	return {
				country: line.country,
				GDP: line['2014']
			};*/
			return line;
		}

		function parseCombined(line) {
			return {
				country: line.country,
				birthrate: line.birthrate,
				gdp: line.gdppercap
			}
		}

	</script>

	<script src = "lineGraphs.js"></script>
	<!--
	<script src = "circleGraphs.js"></script>
-->
</body>
</html>
